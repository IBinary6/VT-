From patchwork Thu Feb 14 10:47:04 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812425
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id E154613B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:19 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id CEAA02D6AF
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:19 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id C25D82D6B3; Thu, 14 Feb 2019 10:48:19 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 789432D6B0
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:19 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2395350AbfBNKsD (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from mout.kundenserver.de ([212.227.126.134]:53495 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395351AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MRC3Y-1gfsX40CwO-00N7gY; Thu, 14 Feb 2019 11:47:34 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>,
        Paolo Bonzini <pbonzini@redhat.com>, kvm@vger.kernel.org,
        libvir-list@redhat.com, "Michael S. Tsirkin" <mst@redhat.com>,
        Eric Blake <eblake@redhat.com>,
        Markus Armbruster <armbru@redhat.com>,
        Michael Tokarev <mjt@tls.msk.ru>,
        "Dr. David Alan Gilbert" <dgilbert@redhat.com>,
        qemu-trivial@nongnu.org, Gerd Hoffmann <kraxel@redhat.com>,
        Artyom Tarasenko <atar4qemu@gmail.com>,
        Kamil Rytarowski <kamil@netbsd.org>,
        Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
        Thomas Huth <thuth@redhat.com>
Subject: [PULL 01/14] qapi: Fix qcow2 encryption doc typo
Date: Thu, 14 Feb 2019 11:47:04 +0100
Message-Id: <20190214104717.3543-2-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
X-Provags-ID: V03:K1:/ADes+TtlmAqBmdFM1Uz6oQLrqd8W0xOgUiFL4z6HhSg57lFgcP
 fw2kSmR+EyiN1io3Ub4+PmnalH9eRqiRcONE2nbAgIHbXEsL9aXVIpdnQHu/iGO2s+h1I/O
 pnfwylKkoAz+jUws/IDC/jDRVYS2qXWKjaO8knpboV5I1Efspjc9DrFh096Xu9txVzrnQ2o
 yPS1L4z3UJqjVAWzc1Okg==
X-UI-Out-Filterresults: notjunk:1;V03:K0:+G4vGsQSh2A=:z0NjIXQm4yKPXDPBMdEhQw
 T5KTRSzTnZE5XuNB6V7Jv6MZuGkFDzeml3pUablhtvj1eG7hVbtLSz5IJptxHTw20sUlWAQ2p
 csElDh9T5PZomSzuI/p/q4AI1XsSeCHmbtyScL4Y3LZqhoBXsMWKrB4V52nUDarlYIS+SMye/
 GksxD7wizxgscDjUigAW1eF3dgFmsAOfMT0IAbzSrC/dF/zGh6ITP8yR48GYHZYlJyV3daigG
 x30HOdpMzXkhWIxdK5ki/Yk1HLlnjCtO/9gvO8uUxWG2JkOZ2lh3kDQWDXnn9liBkOHq0Zbb4
 IBBsJDQBuXAJcQ2jT94lTtJYCxAk6j66UH65ELd2w5SNwZeEZqKWJpOI/7Tl0fm8LG2hQcUaP
 sw9HDvPAONi+bWHkFwQ7XtNTUo5WEKafvmkzxH63FGoedcOz3AbeG8i004h0GRabmcyRNWaz3
 HK6i9KWcNUbxvRPToEx7aHoa6JeqWHgKQ4jmIBtaFCUwsd655w5UPx1mbW1qtaotYJdvtfNAl
 jVg+/o56Bfnps6GVTD47rVW80xBPjA1DvopRRf31KVFlrXngROblrc38IT+/54OP3qqK31onv
 CVhJPY9f1JMZNzAJFQ1f8+QsAO4X1ffrz3v50n/dfYXpTcyLrkzukdtk8oP1X7cGfPXsu9PBh
 3n4HG+gbVWB/uKtMKI5lBI6LziD3ZD9Ff7hdDt9og/Gtua7fyKXTlGoLwyj0tSD+0iYbXVtec
 JHVhywGPBs6bhW9V57ONF1cuEh6lrg1m9U3oog==
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Eric Blake <eblake@redhat.com>

Present since commit b25b387f (2.10).

Signed-off-by: Eric Blake <eblake@redhat.com>
Reviewed-by: Thomas Huth <thuth@redhat.com>
Message-Id: <20190206202848.16999-1-eblake@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 qapi/block-core.json | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/qapi/block-core.json b/qapi/block-core.json
index 0f349d460336..ee1ab7a8a259 100644
--- a/qapi/block-core.json
+++ b/qapi/block-core.json
@@ -2998,7 +2998,7 @@
 
 ##
 # @BlockdevQcow2EncryptionFormat:
-# @aes: AES-CBC with plain64 initialization venctors
+# @aes: AES-CBC with plain64 initialization vectors
 #
 # Since: 2.10
 ##

From patchwork Thu Feb 14 10:47:05 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812437
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id BD38D13B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:30 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id A9EFB2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:30 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 9E3D52D6B0; Thu, 14 Feb 2019 10:48:30 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 3EA402D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:30 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2406726AbfBNKs2 (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:28 -0500
Received: from mout.kundenserver.de ([212.227.126.133]:60731 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2394331AbfBNKsB (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:01 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1M5Q2f-1gsqyQ1MRh-001Rxr; Thu, 14 Feb 2019 11:47:35 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>,
        Paolo Bonzini <pbonzini@redhat.com>, kvm@vger.kernel.org,
        libvir-list@redhat.com, "Michael S. Tsirkin" <mst@redhat.com>,
        Eric Blake <eblake@redhat.com>,
        Markus Armbruster <armbru@redhat.com>,
        Michael Tokarev <mjt@tls.msk.ru>,
        "Dr. David Alan Gilbert" <dgilbert@redhat.com>,
        qemu-trivial@nongnu.org, Gerd Hoffmann <kraxel@redhat.com>,
        Artyom Tarasenko <atar4qemu@gmail.com>,
        Kamil Rytarowski <kamil@netbsd.org>,
        Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
        Thomas Huth <thuth@redhat.com>,
        Peter Maydell <peter.maydell@linaro.org>
Subject: [PULL 02/14] qemu-deprecated: Remove -virtioconsole and -no-frame for
 good
Date: Thu, 14 Feb 2019 11:47:05 +0100
Message-Id: <20190214104717.3543-3-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
X-Provags-ID: V03:K1:QF78azORv0wvVxM7jiTEXMMiFSvQ1oiB3VlThMMO6pvauyqaXEv
 MqBRhELUnAjqOX15TWBaS3ZBeaHB3a0798SV9S2Oip7wobwjm3oRGimoHal3sP9qB7UqraZ
 10ardED7BSnq/Hh3Xzs98Ln5Ra+B/eaSw8BrdZvmntLsPVUdEE/TQt9eEZrucKopCCcdZ41
 k1kCRLzTeWm3tpXPhcPLA==
X-UI-Out-Filterresults: notjunk:1;V03:K0:1c8XzALaI5o=:r4S2hp7pAVFOeMPR93XUon
 sTKpkfQxSLdWjxl/lcyh+iY+5DcO7p6/OxZZCHcIWc8DiiGP4VSVJQanBpnsANprr5rTuuqT1
 DGKzzfb1pBRyfYq5sXAtJK9lux6mXCOnsm8D5kka3HKlHv/PmvFau+gE5sium58R42E2f58Qz
 uEsp87RiFChChrRGoUuzfieoWIKDhcj62Xt4oB2pXfRm7HK0AtWcausVz2tvlvW61hVSEdHso
 tt16AX8eGJEGi5394sApf1WWpLL3fKFKVSh7PC5pj7xRyZNW2w5VcIesA9BCNTz6ufGzKyEwx
 RqW2dwEYe8XTPwjhkHJyPETNXHr8kOIj9LYUXUSZ92N+sywQ1RSIMyAp9w+chqrYdYjuAW4mo
 MpTIRIyHt1ZSwKJ8aeijES04yFmWC5Pgz5GYPk4AbNsSGfCzLfA8HN5BavFvPz8/MX1cDLbZ3
 N88TccAP86eCpkyFiwEmLPNVat56NbXDZ/3RpXgGccstkZ1FFJBsrito/gS0yKPHDKGxl3beS
 DSncp0bIHav5ZSL0UyvhfuLRZeXMXWqWrl6ZeXjloZki4lu8ZVb6SYHT+0ya1rXxbs5djmNcu
 nr4DPAKtCzJCy12EbAKpyRSeI3b2Wgu9vpnl5P/LneRPGCjqj+m4GaX7fE2IvHUksuUehToyu
 ejKJKRx+DcoojLFb4FEMblLTTVYJZWhXuqSfKuoKbcOeirVegrDbPHgpMEvmGEZNcan0y0EQ2
 188KHoWqbkfVnCiI4TCFQbEseY+roK/SKC/0rg==
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Thomas Huth <thuth@redhat.com>

The two sections have accidentally been added again during the
merge of Paolo's and Gerd's trees.

Fixes: 3e29da9fd81002a0c03041aaa26dea6d9dd9bd65
Signed-off-by: Thomas Huth <thuth@redhat.com>
Reviewed-by: Peter Maydell <peter.maydell@linaro.org>
Message-Id: <1549545296-18903-2-git-send-email-thuth@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 qemu-deprecated.texi | 12 ------------
 1 file changed, 12 deletions(-)

diff --git a/qemu-deprecated.texi b/qemu-deprecated.texi
index 80b0702ad5b2..90e5860fd1a6 100644
--- a/qemu-deprecated.texi
+++ b/qemu-deprecated.texi
@@ -37,18 +37,6 @@ would automatically enable USB support on the machine type.
 If using the new syntax, USB support must be explicitly
 enabled via the ``-machine usb=on'' argument.
 
-@subsection -virtioconsole (since 3.0.0)
-
-Option @option{-virtioconsole} has been replaced by
-@option{-device virtconsole}.
-
-@subsection -no-frame (since 2.12.0)
-
-The @code{--no-frame} argument works with SDL 1.2 only. The other user
-interfaces never implemented this in the first place. So this will be
-removed together with SDL 1.2 support.
->>>>>>> remotes/bonzini/tags/for-upstream
-
 @subsection -clock (since 3.0.0)
 
 The @code{-clock} option is ignored since QEMU version 1.7.0. There is no

From patchwork Thu Feb 14 10:47:06 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812427
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id C991B13A4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:21 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id B66532D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:21 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id AA8E52D6B1; Thu, 14 Feb 2019 10:48:21 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 79EA42D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:20 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2405211AbfBNKsT (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:19 -0500
Received: from mout.kundenserver.de ([212.227.126.133]:56713 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2393745AbfBNKsD (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1N8oKc-1h6ztO2ZhG-015q5Y; Thu, 14 Feb 2019 11:47:36 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
 Thomas Huth <thuth@redhat.com>,
 =?utf-8?q?Philippe_Mathieu-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 03/14] qemu-options: Remove deprecated option -clock
Date: Thu, 14 Feb 2019 11:47:06 +0100
Message-Id: <20190214104717.3543-4-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:fMwuivj6jPM8UmCbOAxnZ1XR2DAKcmfvzhgrnENFDYUX+WECKpy
 x0ME08tbSnHY2cImztqK5mgqmGc/a6cgwKlVFQz6jRRV6TdAsQwnt0e7rLDMCMwOArDbaDc
 XCK+P4ySVc9pbRGCCqYEVwoWcOMRzOI4TE9aCHxma7tTYN2GluWJaSneFd2ZfJmKNZVTMZP
 sTbmwGGmmkp3W4EitMM3Q==
X-UI-Out-Filterresults: notjunk:1;V03:K0:DAaAO76alPE=:dDxvoNLHCe6T1BVvN48Iqt
 qLcy3g/RjwHuzMczBDtOqONVslL68uDtmfadqp5mw31/v/Wpd3DNk5WJ4vYsOnBVaWdLHLnqj
 vGx1a0msd47ykLrc5gF3SaSK5o6MRTq0CxVk6oqlQ3qspkU+471/RunjMoei+0IdXKOWSIrbV
 oxAD7PuxeoyCi1YFotoVayU7WNfvqxlLHl+0d+Ynba8SzF7k7EbMLmVKtXHY7XC6oHuJxOq3l
 dW3KbZGdfEl8wFoiVENGReROeaPLlsFboOQHiLR6MyfelfvOMTfoF6L2TjngOUfcwsB6BsQkK
 YiHxilH+CYQRGTfxQxsKDIpD6emCzjt676IbBAMKctZBaiPduLNTfIbT3C/TBqHJTYtYokaWG
 STtI29J4YBljH3RAGelQjVwx4sxnTLCaX5phaFbu8k3L3CPVU1r2fPfBOg3xt4zP9N9epRDoo
 x5ZNHBt/jqlGc6PyV1MoAKXl8/DJB6AkRvFVApbOcQVTSXbAnYPzyG5RelkQtY8nfV/E6v9rA
 /ws2MuNQ2nBwEqiGL8EYPfo1R5a8tC3PBDf5UX7eVNhTvAfQV10doXRwWkTemC29IQRzG7OXs
 E5QnZsoiUC3ty4BqGC37AJ0w8PxX6K8x2bvvua2dmizIe67qsidgKeJxOZ2/1dQKcx/WkrcAX
 ds+tZpQYGIhzwiLNEzg9a31y83Up097PhbC8AYVpmCkrJT2Mi0OgXuOQh5NbkHhffbHcOnit0
 nKNB1eJcr0NrnGkAKLjn6Qj1kp11Y0zPPxqPBmWCfHruCDborGK1ErHRpbI=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Thomas Huth <thuth@redhat.com>

The option is only a dummy since a long time. We've finally deprecated
it in QEMU v3.0, so it's time to remove it now.

Signed-off-by: Thomas Huth <thuth@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Message-Id: <1549545296-18903-3-git-send-email-thuth@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 qemu-deprecated.texi | 5 -----
 qemu-options.hx      | 3 ---
 vl.c                 | 6 ------
 3 files changed, 14 deletions(-)

diff --git a/qemu-deprecated.texi b/qemu-deprecated.texi
index 90e5860fd1a6..fe905551c598 100644
--- a/qemu-deprecated.texi
+++ b/qemu-deprecated.texi
@@ -37,11 +37,6 @@ would automatically enable USB support on the machine type.
 If using the new syntax, USB support must be explicitly
 enabled via the ``-machine usb=on'' argument.
 
-@subsection -clock (since 3.0.0)
-
-The @code{-clock} option is ignored since QEMU version 1.7.0. There is no
-replacement since it is not needed anymore.
-
 @subsection -drive file=json:@{...@{'driver':'file'@}@} (since 3.0)
 
 The 'file' driver for drives is no longer appropriate for character or host
diff --git a/qemu-options.hx b/qemu-options.hx
index 06ef1a7c5c72..77bd98e20b14 100644
--- a/qemu-options.hx
+++ b/qemu-options.hx
@@ -3444,9 +3444,6 @@ Load the contents of @var{file} as an option ROM.
 This option is useful to load things like EtherBoot.
 ETEXI
 
-HXCOMM Silently ignored for compatibility
-DEF("clock", HAS_ARG, QEMU_OPTION_clock, "", QEMU_ARCH_ALL)
-
 DEF("rtc", HAS_ARG, QEMU_OPTION_rtc, \
     "-rtc [base=utc|localtime|<datetime>][,clock=host|rt|vm][,driftfix=none|slew]\n" \
     "                set the RTC base and clock, enable drift fix for clock ticks (x86 only)\n",
diff --git a/vl.c b/vl.c
index 9e4dba7f92f2..90ff23333dd9 100644
--- a/vl.c
+++ b/vl.c
@@ -3735,12 +3735,6 @@ int main(int argc, char **argv, char **envp)
             case QEMU_OPTION_old_param:
                 old_param = 1;
                 break;
-            case QEMU_OPTION_clock:
-                /* Clock options no longer exist.  Keep this option for
-                 * backward compatibility.
-                 */
-                warn_report("This option is ignored and will be removed soon");
-                break;
             case QEMU_OPTION_rtc:
                 opts = qemu_opts_parse_noisily(qemu_find_opts("rtc"), optarg,
                                                false);

From patchwork Thu Feb 14 10:47:07 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812409
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 4956713B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:01 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 2AE572D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:01 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 1C4B52D6B0; Thu, 14 Feb 2019 10:48:01 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 9D0802D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:00 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2391190AbfBNKr7 (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:47:59 -0500
Received: from mout.kundenserver.de ([212.227.126.134]:36979 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2390773AbfBNKr6 (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:47:58 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MOAJt-1giuno3dWL-00OV8J; Thu, 14 Feb 2019 11:47:38 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
 Cleber Rosa <crosa@redhat.com>,
 =?utf-8?q?Philippe_Mathieu-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 04/14] configure: remove handling of "wav" audio driver
Date: Thu, 14 Feb 2019 11:47:07 +0100
Message-Id: <20190214104717.3543-5-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:FmmfoOelMXqUzvgQsrVszvn6/zKDiCufRwYfyb+DICJPCQNBHQL
 kvc2R81pW4ZFGJ9hXekaLa9RR+JQ/F1Vh7VZARq8z2Yj/7DIOl7FSDwT1AwrfxewuC2avSr
 5LXdBG6sR9kRvmp3U4g7wu8s6fKhvvfRxth9HhRkqe2rdL4yuolrlFSsDKhX5kpimjjat32
 8tOtCZslhxYwMl01K+tKw==
X-UI-Out-Filterresults: notjunk:1;V03:K0:VANOha2S0q8=:qiBkKT13CfCu3HdYBV9baI
 XwHRSG0GhQFMxnkFOGb5MNq966CAOVxK836j8JMUDyXtubnsfrfhBfYa3nhpohE/iUF1BmsWX
 8HGSQDDClJpFFVirOnydbtFaoBoq+hWvZa/M9SOjoZ7CVcnbt/G9KamGFgfal1d3uHb412tzn
 pUQtUCH0B+LU5P3lvyrh9KEAxm9jkrZ32EDA54neU2xMw4Pt8aUSrVhT7LDN4ycNvy7yW/Gao
 /l+y/ANfJZ9Aj0oIPU8XvmvUGgYAVGxh8Qd/myoYA2uno7DdhtAyi67syx9JadbpnWGWR/WKq
 cRo7+1KlE1uerWQiXx97TIS056zkJasnja92IPdIF6v0HGllOu5CPZESqT2p4YT9lQXFL4k5E
 f2iL+azt15Gqs2Fdl0fjHhSS2SNvtt3FrK8HErdPoIJQcuk+oveHS8LuC6tj998tqtz8cxBTe
 FnPWlKfqQEkPTLWL+f+YeUIaBKyegfXmwDD67IV0NODoGU18cRNF9f1DuIVZlkX+OAjIDXWkX
 EdK/xxZi7OQpfcRIjWOJXxLXFRSimFjnRlT6R6Fn+hycqXLgdqudMclwZMT0J19LyjGq6Dh6D
 7J3FH4jCmev3pc6xjQyM1lwMYd40NaMfz1YJc/2Oe+Rg2xKvpqlMjrSwznZjR85BpSv075QOs
 A9u1tFod7XX/3Su6zsS/vdmPjV+romqTzu58/3Q+aiBD8/7uWnoRh5wEc26h2DdGBnFbrnzQH
 UX6S2OKCcZGplw5l+nZ8KN3V8HVyzxL4qUTqOCXHshcppoiqIwpn1jD1XZg=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Cleber Rosa <crosa@redhat.com>

This looks like a leftover that was never implemented.

Signed-off-by: Cleber Rosa <crosa@redhat.com>
Reviewed-by: Laurent Vivier <laurent@vivier.eu>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Message-Id: <20190207193605.25676-2-crosa@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 configure | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/configure b/configure
index fbd0825488c6..ff55e2273e9a 100755
--- a/configure
+++ b/configure
@@ -3350,10 +3350,6 @@ for drv in $audio_drv_list; do
       oss_libs="$oss_lib"
     ;;
 
-    wav)
-    # XXX: Probes for CoreAudio, DirectSound
-    ;;
-
     *)
     echo "$audio_possible_drivers" | grep -q "\<$drv\>" || {
         error_exit "Unknown driver '$drv' selected" \

From patchwork Thu Feb 14 10:47:08 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812413
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 0D96D14E1
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:05 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id EE84E2D6AF
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id DF6162D6B0; Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 95AA92D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2405461AbfBNKsD (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from mout.kundenserver.de ([212.227.126.130]:37917 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395363AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MFKbB-1gromo0Tur-00FnyB; Thu, 14 Feb 2019 11:47:39 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
 Cleber Rosa <crosa@redhat.com>,
 =?utf-8?q?Philippe_Mathieu-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 05/14] configure: fix qemu-img name
Date: Thu, 14 Feb 2019 11:47:08 +0100
Message-Id: <20190214104717.3543-6-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:G6beaHq4Do7Rtym5Ov/cf+L4w+QN4pQnn2pIgj9nDQn1zg4P+wY
 w0ruR2VNdDJMhogsglfXcw/WQb+/ha0CT7aQmef5A9SuD3F19Ci9RbgYsKuMvyzpqGYEEZf
 nbdBmAsVDJe4ZPemZ7lKnUKmA66FW47JsM8iapRovkIqQC8xN91AkojLs82VOYrfcrxWFWT
 L9Ow5zBL93473bGKifvng==
X-UI-Out-Filterresults: notjunk:1;V03:K0:ixSXCtuTd7w=:8QtMcCXviHZiZk0qLhO0UQ
 QcsMtdr0EN5ygskIUlAYgPQ0Cjrwl53Hn7xWHupsBZgMyxfWmT/Iaeyl3gDhXuNUUB9jV70f7
 tz1j6vVASG3Y+1HUXBf136Re04nvqrr47KKmFEMR/yJa5apZazk4/+VB14gYNqZiYwcw8L+1I
 CppXea22FshDoCucdGkLz5iaaY8MuNCWncBeNvLRXcLeRc/9T2dn1PYUVJdrozSp95SiP4Eru
 KaUhBZtO2s6u33r0kmAr6+wfGTIGWDAO9JCIu6hFNcn2P6M/lqxl7GhUSBdMAbjLeH/87fPIL
 ch26m1VHoUF7KutqSjmScW8fW08cyiRajcKQV36zI2xu/vtRvs1cDC0UTHVqLqERlkISzzXCJ
 nl4lJquwp1vbJiGFjGj89CHzHk8RhfL0ipGJ9qpaaSszBJuXcixOHoL9dhus4KSO7XgX6OXgc
 O/HO7vegU6Gib3fb8C19cw6UoOixY8rXR7ILajlV0rNWoIkQHzwhg4b7Hds5bMPlvoxYCg3s1
 c0R+VResVtvHtBEbB6fQJr3AM/sqNMIl9RaragWGju3iWYXtWgDxwjqHA2cG31uSoRj0HMals
 610B/I9sGFQyC1Oq7pn94O/HyT5AInN8STpHcpVwtKQ5cyWUh4R/7qotuqw4uVee96T3MEHA+
 5ohzOj4bbmoSAdmFjnQ68TJdXLfK5uyh20ZDwBlE6cfwJpQ1uVnJS5RL2ciuFwi/GbJY/wX9F
 Qg9AYlhvve3XA4o+CHc1uRyeNnoJhgf1BmR3bB8ZOSPOTc8jgvCDtdvlOC8=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Cleber Rosa <crosa@redhat.com>

Signed-off-by: Cleber Rosa <crosa@redhat.com>
Reviewed-by: Laurent Vivier <laurent@vivier.eu>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Message-Id: <20190207193605.25676-3-crosa@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 configure | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/configure b/configure
index ff55e2273e9a..c8fc1647fe69 100755
--- a/configure
+++ b/configure
@@ -1768,7 +1768,7 @@ disabled with --disable-FEATURE, default is enabled if available:
   virglrenderer   virgl rendering support
   xfsctl          xfsctl support
   qom-cast-debug  cast debugging support
-  tools           build qemu-io, qemu-nbd and qemu-image tools
+  tools           build qemu-io, qemu-nbd and qemu-img tools
   vxhs            Veritas HyperScale vDisk backend support
   bochs           bochs image format support
   cloop           cloop image format support

From patchwork Thu Feb 14 10:47:09 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812433
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 8001813A4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:26 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 6D6112D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:26 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 613672D6B0; Thu, 14 Feb 2019 10:48:26 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id EB2392D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:25 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2395375AbfBNKsC (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from mout.kundenserver.de ([212.227.126.134]:36375 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2393745AbfBNKsB (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:01 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MmDVA-1hKnwi1Lt2-00iExa; Thu, 14 Feb 2019 11:47:40 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>,
        Paolo Bonzini <pbonzini@redhat.com>, kvm@vger.kernel.org,
        libvir-list@redhat.com, "Michael S. Tsirkin" <mst@redhat.com>,
        Eric Blake <eblake@redhat.com>,
        Markus Armbruster <armbru@redhat.com>,
        Michael Tokarev <mjt@tls.msk.ru>,
        "Dr. David Alan Gilbert" <dgilbert@redhat.com>,
        qemu-trivial@nongnu.org, Gerd Hoffmann <kraxel@redhat.com>,
        Artyom Tarasenko <atar4qemu@gmail.com>,
        Kamil Rytarowski <kamil@netbsd.org>,
        Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
        Kamil Rytarowski <n54@gmx.com>
Subject: [PULL 06/14] configure: Add HAX support in NetBSD
Date: Thu, 14 Feb 2019 11:47:09 +0100
Message-Id: <20190214104717.3543-7-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
X-Provags-ID: V03:K1:LybyNIzL5PtJPYuxTsW6vJRXiHRfDatM9TBDBQYLmYe156TCeeS
 YYBn5noBCb0Y/NC4pJyzsZOvAu7jIjs/7VVKx8zip5t6vE5z30JT4bC8AgDgeUn5C34lTwh
 mvdxCA4fA2PgYM/IYamwvYaGS8qB24rkbCATnO2qwS9ZXUqYGmH/IgTAiuNC+7QQrEV7U2j
 Nb1mnM1leCn/vpxqJ5U/Q==
X-UI-Out-Filterresults: notjunk:1;V03:K0:XgyjFiGsFus=:x0oWvUqLdg/3czLC9FyQCG
 RUH1c2Nzwj61CSLdBcTOQs4stuVX23iCbwsNuuVCKVomEhAOjkvsiKHj1M6T5suHfctz8qj/a
 0pE5QdxvCCO5Ul4DwglDkokSBgjALfzdadTDEF57+DN51Hcz3g8X0m7Uq8aMWYb/BZ1OnvQKw
 kPz7RY8AB3akAjLWAR7b66j2FuQl/hwuF1IHg1I7fELtbLgSVT/hKXDWt58J2nhXuInFNBzp7
 jEydQNAloBktTW8q1NfQNlrJaYrOpH/XhHrwvEqSyfS6p7vLr2Mm6gp0xQfAHSpzFU4MPyyAd
 hsUZaEO2HLU79L9x0dDlm0wSgOQNB6EHujunGbPTDfeNr+f6TVaQI/wzuC+0nXNFVQY0NEvyj
 3S01L5lIzezIWJ3SGnhNlTgIZ7sv6RZTPUEMQaWUcgZ5Pd5aJgB6+OCdt3+OIcsb3VrWY1lqR
 eq4JXQTBMb/QuCHz5C7rqY94BJlr3b3hNirbOpBVTsmx1uKfl6b/JVbi76uHT5eMZCIGW9LLc
 oBCHT7prK8y0xGYvGOMZdkZ6aYd/0P92sqUCGZiMp0Cy331EXtns0Y7xICQmI2Rsi2EQHIpiK
 9paQK+UOPrbYEDmMSPxAs/Ult2NSdkvyExg1lVLOCGp9cGBbrqEVFAkIbGoTYKNNtdAjAxxNh
 3t+qUHTKGty5bOOr1oAIG3hLtEaC9sYW4OOnG3pZ9JSYc/QR4/gz/aN/ZIs+7pTpLC+EQPF7+
 u8FXVrLZL+u08/cj1qazWE8qUfbToeCZuXTygw==
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Kamil Rytarowski <n54@gmx.com>

The NetBSD support in Intel HAXM has beem merged upstream and is functional.

Signed-off-by: Kamil Rytarowski <n54@gmx.com>
Message-Id: <20190207233704.29978-1-n54@gmx.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 configure | 1 +
 1 file changed, 1 insertion(+)

diff --git a/configure b/configure
index c8fc1647fe69..649ef1b158d1 100755
--- a/configure
+++ b/configure
@@ -817,6 +817,7 @@ DragonFly)
 ;;
 NetBSD)
   bsd="yes"
+  hax="yes"
   make="${MAKE-gmake}"
   audio_drv_list="oss try-sdl"
   audio_possible_drivers="oss sdl"

From patchwork Thu Feb 14 10:47:10 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812417
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 6931C14E1
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:06 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 566F72D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:06 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 4A9392D6B0; Thu, 14 Feb 2019 10:48:06 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id EC0E62D6AF
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:05 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2406352AbfBNKsE (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:04 -0500
Received: from mout.kundenserver.de ([212.227.126.133]:52801 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395379AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MNc5b-1gjSli2iJX-00P365; Thu, 14 Feb 2019 11:47:41 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
 Peter Maydell <peter.maydell@linaro.org>, Thomas Huth <thuth@redhat.com>,
	=?utf-8?q?Philippe_Mathieu-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 07/14] configure: Make -Waddress-of-packed-member warnings be
 errors
Date: Thu, 14 Feb 2019 11:47:10 +0100
Message-Id: <20190214104717.3543-8-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:LEi8iVxFcJaDz5gPX+ZYRsQHg8ggi6pDPEYJihnlM//Ea2EfxQf
 MXIu+Owh299+SlKSlPDUtDhp6h4hzmKOry2VR8vyOYiR8Zz8GhEohi+XurXKvPd/nimwOIV
 3XLrWX+BHj2TlfLcj2SeYIlib8koa+G+n/VW4X/Gr6brYg8txoTRq9euRSgKOpyA9KSjSgb
 icTMcofZxRsRIBoAQvoRA==
X-UI-Out-Filterresults: notjunk:1;V03:K0:iRDg/sQmhhY=:5Mf6c0zaNWdiG/LfBsIjhb
 QOwMbSZ7e+78N8R1v3EFtcQW/ZgEss0pxfB1bd9GYtbb9vv0tjmZftMQoiqbqwCDP3OvHTYfN
 uqg3AMQT++G6UZcOwUSOSaYNfbJmX3YEFFKoriPFRJwunvs3oSizX1ANtXI/rRUQ3gEsjApXp
 H+FMKCApEQFTmAJeqpqEdc1zKtrdimYPApCjiXoruZKT+yJj9k37XyTuhKQjQ8wWdwR6JGIgL
 cNZ7lhKYWv2l78Cm9Vq8itYGP8kCJDqqYnpYBZl+dbQj/095+mNlZNy2X1QDj21iWtX6aTksB
 nl2ciEYDHgw1A7llGU54YKubOKFIXO1SENEbAcy0uwcJ02XDld5mZMds0HRkOIWuy9zgOxCuZ
 w08VuhMmMDC80Hiwe+kTceOnU1YPxEdPD+g/s+KaojJ44pK56KJhmBbn0jF9Ir4u/pvJGyMYg
 byj4+K5T2MIIvmRt4EMMgKzw9SN2g8wOhw2oEFeNPvro98vy4Ed6OUGclEmLH7mw55+CXcq3y
 m/saOiwnrkCzRRJzscRkStpAh8FE28Py5XpEIaWd3I9OHCV5Coz4ZPIYiLoO8BXw0ul9klQ66
 yvZVDbyAydjSShWQ0vgPd9oqYq5sYh8fhRyZMoG5ZJj7dE8l6hr0VSxUpxrHS/bEjniHTqbZa
 KzclpyxMU3HMkLBitKwzDmT1gBgZzUfo703YnXF5T7loz2SIqhqssIPmtsKRqB4VCn7pLLAEG
 WTYv6jgnwwZBDOkoOt0soKBo+vLu+lW/nV4InkcLiUPC9aD35OwF6iTrPrg=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Peter Maydell <peter.maydell@linaro.org>

We have now managed to eradicate all the places in the codebase
that triggered clang's -Waddress-of-packed-member warning. Remove
the compiler flag that exempted it from our usual -Werror policy.
This will prevent any new problematic code being added in future.

Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
Reviewed-by: Thomas Huth <thuth@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Message-Id: <20190208132112.31493-1-peter.maydell@linaro.org>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 configure | 1 -
 1 file changed, 1 deletion(-)

diff --git a/configure b/configure
index 649ef1b158d1..c0f278141823 100755
--- a/configure
+++ b/configure
@@ -1882,7 +1882,6 @@ gcc_flags="-Wno-missing-include-dirs -Wempty-body -Wnested-externs $gcc_flags"
 gcc_flags="-Wendif-labels -Wno-shift-negative-value $gcc_flags"
 gcc_flags="-Wno-initializer-overrides -Wexpansion-to-defined $gcc_flags"
 gcc_flags="-Wno-string-plus-int $gcc_flags"
-gcc_flags="-Wno-error=address-of-packed-member $gcc_flags"
 # Note that we do not add -Werror to gcc_flags here, because that would
 # enable it for all configure tests. If a configure test failed due
 # to -Werror this would just silently disable some features,

From patchwork Thu Feb 14 10:47:11 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812435
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 7B7ED13A4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:28 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 6979E2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:28 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 5DDA22D6B0; Thu, 14 Feb 2019 10:48:28 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id E8F512D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:27 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2395353AbfBNKsB (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:01 -0500
Received: from mout.kundenserver.de ([212.227.126.187]:55797 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2390773AbfBNKsB (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:01 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MlfGs-1hLLuW3hXG-00imvM; Thu, 14 Feb 2019 11:47:43 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>, =?utf-8?q?Philippe_Mathie?=
	=?utf-8?q?u-Daud=C3=A9?= <philmd@redhat.com>,
 Stefan Hajnoczi <stefanha@redhat.com>
Subject: [PULL 08/14] pckbd: Convert DPRINTF->trace
Date: Thu, 14 Feb 2019 11:47:11 +0100
Message-Id: <20190214104717.3543-9-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:iaG/nFgEendP6IDARXyTKjdsT7UpTyxg0+hriBohdWV6KSBFIyM
 3ZYDO8HFuCJy2+CmRxZW6gDJyX9r+U4T+TVkCtKaea4kNebmf0jD/gw5e8bFMaogy4FHgTW
 JjJQQJvnn0MoZQ8oEeat92gnV3ZFIxq5jA+JatowoouzZOMIjgmo0mDTN+l5U6hVJvRYgSh
 FbAA26VuJ3yRFytzPgQvg==
X-UI-Out-Filterresults: notjunk:1;V03:K0:ySIu+flUAaM=:dRQQ3e5+t0Ve3mK1PyaUR6
 +3eegs8b89JaX3BMhztTgrcWJnxXYxWCqM3v9KKtRq/vkUYNfn2SnzfhBQDYYuxn4yeaLe7wY
 DxWWBbQo8QQf9grK1ttknBuLp9XMjTOM+e2nkDUHOgqZUe6OWXSDUz85uetoRwWZlBT4veCtl
 OvDVoUVMqIBWLP4OV1to9pNz0RAIABluNE/3bvZuXkDS3oARIfD6G4sG3khqaJJuvjgHOi+Jn
 RrXTUqFzzgFQ+88IoK2GEFGuKLkzpEV32u3E4Y55g9wow9FbSBI4GMPiZttBk9+mkeTrpuNk4
 EplbmsJxbtDtsLkS9xcj6ff3qzJoU9LLDCB/HP8cZbrQtSinWW4hZP/FTf179/x8LHo0eXLnq
 8/qa8iwlFauHuhhUAIjzY//v0/OpCY2wyixoV5/Fgz03Os8SlIciByvx5T/fGwOjsM11YWxs8
 lSzmsE1+FUS3eUIZWYME6jNpNkcElMkYDacsDNqPNCYVyL9vTNqiLyQbNS65hshNBnJpNhMyV
 fr/JGpksv4lb/3qjhc+n96uvHMJ0VeuEymZ07zirJvL4MSVVfsEo6RUofaiIUkrUwXRXE8rqP
 izHg1NHa9Q1lAne9wpCdpk2N76FhqTW78VJ/ChI8ZyBxyQcamxjxIEf+Iw2OutB0gLxRE3x0V
 Xv+Yj6HzLDlzXikALVqvnpY9OjVZzOe1uJ9uKIruMmSLYmTldci6m56tc24KEO54vF9152+6X
 kf0b95L28erEj1w6jXcXoLrosM0Cp6zGekrQRNFizBQXmjwSp2mxQyLNHqA=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: "Dr. David Alan Gilbert" <dgilbert@redhat.com>

Signed-off-by: Dr. David Alan Gilbert <dgilbert@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
Message-Id: <20181016112232.23241-1-dgilbert@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 hw/input/pckbd.c      | 19 ++++++-------------
 hw/input/trace-events |  7 +++++++
 2 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/hw/input/pckbd.c b/hw/input/pckbd.c
index 72e7d5f6cc50..47a606f5e3a0 100644
--- a/hw/input/pckbd.c
+++ b/hw/input/pckbd.c
@@ -30,14 +30,7 @@
 #include "hw/input/i8042.h"
 #include "sysemu/sysemu.h"
 
-/* debug PC keyboard */
-//#define DEBUG_KBD
-#ifdef DEBUG_KBD
-#define DPRINTF(fmt, ...)                                       \
-    do { printf("KBD: " fmt , ## __VA_ARGS__); } while (0)
-#else
-#define DPRINTF(fmt, ...)
-#endif
+#include "trace.h"
 
 /*	Keyboard Controller Commands */
 #define KBD_CCMD_READ_MODE	0x20	/* Read mode bits */
@@ -210,7 +203,7 @@ static uint64_t kbd_read_status(void *opaque, hwaddr addr,
     KBDState *s = opaque;
     int val;
     val = s->status;
-    DPRINTF("kbd: read status=0x%02x\n", val);
+    trace_pckbd_kbd_read_status(val);
     return val;
 }
 
@@ -224,7 +217,7 @@ static void kbd_queue(KBDState *s, int b, int aux)
 
 static void outport_write(KBDState *s, uint32_t val)
 {
-    DPRINTF("kbd: write outport=0x%02x\n", val);
+    trace_pckbd_outport_write(val);
     s->outport = val;
     qemu_set_irq(s->a20_out, (val >> 1) & 1);
     if (!(val & 1)) {
@@ -237,7 +230,7 @@ static void kbd_write_command(void *opaque, hwaddr addr,
 {
     KBDState *s = opaque;
 
-    DPRINTF("kbd: write cmd=0x%02" PRIx64 "\n", val);
+    trace_pckbd_kbd_write_command(val);
 
     /* Bits 3-0 of the output port P2 of the keyboard controller may be pulsed
      * low for approximately 6 micro seconds. Bits 3-0 of the KBD_CCMD_PULSE
@@ -326,7 +319,7 @@ static uint64_t kbd_read_data(void *opaque, hwaddr addr,
     else
         val = ps2_read_data(s->kbd);
 
-    DPRINTF("kbd: read data=0x%02x\n", val);
+    trace_pckbd_kbd_read_data(val);
     return val;
 }
 
@@ -335,7 +328,7 @@ static void kbd_write_data(void *opaque, hwaddr addr,
 {
     KBDState *s = opaque;
 
-    DPRINTF("kbd: write data=0x%02" PRIx64 "\n", val);
+    trace_pckbd_kbd_write_data(val);
 
     switch(s->write_cmd) {
     case 0:
diff --git a/hw/input/trace-events b/hw/input/trace-events
index 3965a842aee5..8e53ae5bbf15 100644
--- a/hw/input/trace-events
+++ b/hw/input/trace-events
@@ -14,6 +14,13 @@ adb_mouse_readreg(int reg, uint8_t val0, uint8_t val1) "reg %d obuf[0] 0x%2.2x o
 adb_mouse_request_change_addr(int devaddr) "change addr to 0x%x"
 adb_mouse_request_change_addr_and_handler(int devaddr, int handler) "change addr and handler to 0x%x, 0x%x"
 
+# hw/input/pckbd.c
+pckbd_kbd_read_data(uint32_t val) "0x%02x"
+pckbd_kbd_read_status(int status) "0x%02x"
+pckbd_outport_write(uint32_t val) "0x%02x"
+pckbd_kbd_write_command(uint64_t val) "0x%02"PRIx64
+pckbd_kbd_write_data(uint64_t val) "0x%02"PRIx64
+
 # hw/input/ps2.c
 ps2_put_keycode(void *opaque, int keycode) "%p keycode 0x%02x"
 ps2_keyboard_event(void *opaque, int qcode, int down, unsigned int modifier, unsigned int modifiers) "%p qcode %d down %d modifier 0x%x modifiers 0x%x"

From patchwork Thu Feb 14 10:47:12 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812421
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 88B4813A4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:09 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 76EA42D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:09 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 6A06E2D6B0; Thu, 14 Feb 2019 10:48:09 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 128C42D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:09 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2395426AbfBNKsE (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:04 -0500
Received: from mout.kundenserver.de ([212.227.126.130]:38165 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395336AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MQ67s-1ggyzQ0KCO-00M1Dy; Thu, 14 Feb 2019 11:47:44 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>, =?utf-8?q?Philippe_Mathie?=
	=?utf-8?q?u-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 09/14] HMP: Prepend errors with 'Error:'
Date: Thu, 14 Feb 2019 11:47:12 +0100
Message-Id: <20190214104717.3543-10-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:oGbypwVScPHHEzj9ZvWC6uTpZ9QmKHA9ZweDcvFgFw4KlmgeF8J
 GfyBD//AVbHoQWFRz3qgJQZDYxqzpURK0p6SshkWcLpjcIZHqgZrE3FFOKLrzFqgEXo1z9N
 iBljts6IW9ZspTZA2yy23QX+NajCsJ1clua3S9BU+t89D/7og3oCA9zO+cBAWf8daDfgdZG
 QMNSNnOBEQ/re1PzApEVw==
X-UI-Out-Filterresults: notjunk:1;V03:K0:dtU9daHTNIw=:GnukZdjyBffmVVs7hKGk4M
 CAco6FUK5YZH1oIr46EhswAghQ5H+YKJYg9zo5n7JTClJ6NwiBX7fvxOjfWdxT4U4GFhKZ+b6
 GeDRWaPQ36yJOnw9pILnnhMYwMZDSN9reCV0Gir5BsBng6hPNIGjHU9OkgZTlmZd/cgJzrM9d
 n8bWMCbfs9DBrV8TtTkI3rlUqYbGHIjAO+JlyjVmgFXBjM10Ixogw4HHGaVIKa/Y75a7GxBpd
 LTeVDp3ubc8yvy84gThS/FbZTrubgOcfnfJfwL08RG7XUIksp88mnJ/M1DcLcN4F0y3u34w69
 xJ8uUKnF1+fLsDZTnkqL+7W0MzPYR63gcClMzEfsn+8sdre02Vs3Onc1cwHAj2R6vGYQxxJeL
 +WJ0VEIw2NjXVjB/1LY3tFLW7aVlJ8T4UuhzrOhXhrwWn9WjyXJupeOyjJMjjlOE1AMk/5EWh
 67dqBM0ZKSh63R3yjWCsGfr6OTWOCYJzr2uaMxgAZriq89sz0nP0J4FG2kaNy68FC6hX9P5sL
 Ew0RoIbiGYSXXzrdHHpdrTqwCWYoqTOc73R61daSYih2f/WZh+gtrcI0qiipeW6gJ5ty+3XDm
 74cCl6hLgiFKPXeHgFshleFR2jHTAZb0avIkuWzRSvuSlNDJ95EwIz40rfG2MNmeRfxTleRDn
 K86kUpA7RVrt0DS/bWZqAa2ERITToUW2ypO7/2a12oS6nIR6hceN0E9AyNtx2qOahthZ5th74
 6jDKX5OwSaapcgdG0gbcOkT4j1nh1AdzYeBaZNMN0ylURpFqeLJuX2QcU+c=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: "Dr. David Alan Gilbert" <dgilbert@redhat.com>

Always make error messages start with 'Error:' as a fallback
to make sure that anything parsing them can tell it failed.

Note: Some places don't use hmp_handle_error

Signed-off-by: Dr. David Alan Gilbert <dgilbert@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
Message-Id: <20190212134758.10514-3-dgilbert@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 hmp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/hmp.c b/hmp.c
index b2a2b1f84e33..4d14718fea4a 100644
--- a/hmp.c
+++ b/hmp.c
@@ -62,7 +62,7 @@ static void hmp_handle_error(Monitor *mon, Error **errp)
 {
     assert(errp);
     if (*errp) {
-        error_report_err(*errp);
+        error_reportf_err(*errp, "Error: ");
     }
 }
 

From patchwork Thu Feb 14 10:47:13 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812429
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 876A113B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:23 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 743AE2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:23 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 684482D6B1; Thu, 14 Feb 2019 10:48:23 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 0DFE32D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:23 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2406740AbfBNKsW (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:22 -0500
Received: from mout.kundenserver.de ([212.227.126.135]:48939 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395372AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1Macf4-1hWKGR1PXm-00cAA8; Thu, 14 Feb 2019 11:47:45 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>, =?utf-8?q?Philippe_Mathie?=
	=?utf-8?q?u-Daud=C3=A9?= <philmd@redhat.com>,
 Cornelia Huck <cohuck@redhat.com>
Subject: [PULL 10/14] kvm: Add kvm_set_ioeventfd* traces
Date: Thu, 14 Feb 2019 11:47:13 +0100
Message-Id: <20190214104717.3543-11-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:bn7cnTR+eiZqq/aJtEMxDtq3cvIV45cRfkXMqTtT6HyPuRIMM/0
 doczfiGvxhpwHIp0S+DIT2g3QKjdm7mLVRW84orkdkUp1kc/imDBIvSNmFo92maXOCULrWt
 u/obgNZgjiIweAKgG9QimHwG4JUVJ1PomhAfg/vSTRSvupOdTRpBt+oKGw1vtocB3S5HpAs
 7fSXE9WrNkVfjsf57p9/Q==
X-UI-Out-Filterresults: notjunk:1;V03:K0:LzwBIm6mYS4=:G9glWamBRQMrNFzjY0Mozv
 6MTLf8x01VKCKhk8OGu7r0ROQfe1s0xOjUx4XIj8qG0gS4mAqEvyIZw+DlSn/pAAQ27bQQVfA
 7W0nn/h6OdaHOiDUcmAb7e3j5khkwqFALQ166DCdfG3vlz6a0Aq38sbLSHEAvdPCOKFPgf88k
 xjXMjwY+ucexOVmccU6wT/43aBp2Bi6mJ2vXX9RkLtqi08aLkaWUDSc6/yUiwL+/LOZONr4W/
 UI+bw9ERLfW9NmIAa0ZGIIRY9mQaVcOzNPdRjN9Kb0Xzn20IMqyF3muXsunwiCKCdOCUm3TXV
 bfuy2WSyb17LapseAk9UeFY6rhI4AZiZjUo/oHZEsoWPlpHbksH7DZR5CoEvajdYTCMuec/ew
 9rA3zEKhSYth/hjrwGF8Xypb/d4wI+GXvVMISstVDfUukh/XNQANwlkJscwGshBSGLxvtFJtB
 GwVikWbbBrMk+CLFln3ajA67ksFvQriHLb0uK/8str4BrmHYGDgAw+LNFLzoDWISq9KN1Eupa
 Uji6L5eJDYJ5BEheTycErwz+pItzVIE9LHxXGzixPxozIz2P6luycrFzz48VjGMOp1fL4FykR
 YTbxrOSwkSOSBIj4nU5x77yMCBhmhjsYZGWYMTq5qUgRcTk5g14jH6hFJxyEr7uAFy6hy5ZEn
 FX9D+qx9k8zcBlRHPSYSZjxErLW7ff4TApubGNA961MqWLttynS9HaaEk79VmL21egPlybmTD
 jPRm4SUV8Pm7QKYbYBB6hK51+anfNBGF5ztDH7iMEBWyf09usVcDBgpzOzA=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: "Dr. David Alan Gilbert" <dgilbert@redhat.com>

Add a couple of traces around the kvm_set_ioeventfd* calls.

Signed-off-by: Dr. David Alan Gilbert <dgilbert@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Reviewed-by: Cornelia Huck <cohuck@redhat.com>
Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
Message-Id: <20190212134758.10514-4-dgilbert@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 accel/kvm/kvm-all.c    | 3 +++
 accel/kvm/trace-events | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/accel/kvm/kvm-all.c b/accel/kvm/kvm-all.c
index 4e1de942ce55..fd92b6f37547 100644
--- a/accel/kvm/kvm-all.c
+++ b/accel/kvm/kvm-all.c
@@ -657,6 +657,8 @@ static int kvm_set_ioeventfd_mmio(int fd, hwaddr addr, uint32_t val,
         .fd = fd,
     };
 
+    trace_kvm_set_ioeventfd_mmio(fd, (uint64_t)addr, val, assign, size,
+                                 datamatch);
     if (!kvm_enabled()) {
         return -ENOSYS;
     }
@@ -688,6 +690,7 @@ static int kvm_set_ioeventfd_pio(int fd, uint16_t addr, uint16_t val,
         .fd = fd,
     };
     int r;
+    trace_kvm_set_ioeventfd_pio(fd, addr, val, assign, size, datamatch);
     if (!kvm_enabled()) {
         return -ENOSYS;
     }
diff --git a/accel/kvm/trace-events b/accel/kvm/trace-events
index 58e98efe5dea..8841025d6895 100644
--- a/accel/kvm/trace-events
+++ b/accel/kvm/trace-events
@@ -12,5 +12,7 @@ kvm_irqchip_commit_routes(void) ""
 kvm_irqchip_add_msi_route(char *name, int vector, int virq) "dev %s vector %d virq %d"
 kvm_irqchip_update_msi_route(int virq) "Updating MSI route virq=%d"
 kvm_irqchip_release_virq(int virq) "virq %d"
+kvm_set_ioeventfd_mmio(int fd, uint64_t addr, uint32_t val, bool assign, uint32_t size, bool datamatch) "fd: %d @0x%" PRIx64 " val=0x%x assign: %d size: %d match: %d"
+kvm_set_ioeventfd_pio(int fd, uint16_t addr, uint32_t val, bool assign, uint32_t size, bool datamatch) "fd: %d @0x%x val=0x%x assign: %d size: %d match: %d"
 kvm_set_user_memory(uint32_t slot, uint32_t flags, uint64_t guest_phys_addr, uint64_t memory_size, uint64_t userspace_addr, int ret) "Slot#%d flags=0x%x gpa=0x%"PRIx64 " size=0x%"PRIx64 " ua=0x%"PRIx64 " ret=%d"
 

From patchwork Thu Feb 14 10:47:14 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812423
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id B3CEA13B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:11 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id A19DA2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:11 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 958512D6B0; Thu, 14 Feb 2019 10:48:11 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 238062D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:11 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2406723AbfBNKsK (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:10 -0500
Received: from mout.kundenserver.de ([212.227.126.133]:49211 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395405AbfBNKsD (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MX00X-1ga9NL2AtF-00XKox; Thu, 14 Feb 2019 11:47:46 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>,
        Paolo Bonzini <pbonzini@redhat.com>, kvm@vger.kernel.org,
        libvir-list@redhat.com, "Michael S. Tsirkin" <mst@redhat.com>,
        Eric Blake <eblake@redhat.com>,
        Markus Armbruster <armbru@redhat.com>,
        Michael Tokarev <mjt@tls.msk.ru>,
        "Dr. David Alan Gilbert" <dgilbert@redhat.com>,
        qemu-trivial@nongnu.org, Gerd Hoffmann <kraxel@redhat.com>,
        Artyom Tarasenko <atar4qemu@gmail.com>,
        Kamil Rytarowski <kamil@netbsd.org>,
        Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
        Gerd Hoffmann <kraxel@gmail.com>
Subject: [PULL 11/14] wavcapture: Convert to error_report
Date: Thu, 14 Feb 2019 11:47:14 +0100
Message-Id: <20190214104717.3543-12-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
X-Provags-ID: V03:K1:d+kNLakKyr+Vr+dBEmmNfauzVYZSbZwhd6bUBwfm1SgYlljxwXL
 pM5b0w26z+dQtOJSwbYI12ZZ04mhHq6xJODKScFzr7iZsJQrzNDGfHiEcFmIIozvBROjVqb
 95eGF0NzTt17p6pwp4VIAsFPgj5h2wa9xF18vMwwim/g4p0W3dGYGVYk4SUez110h4WSuHL
 pm8JqutBZOs/qPrt+TKOQ==
X-UI-Out-Filterresults: notjunk:1;V03:K0:iwLeW2vOwPc=:z6DP5FR9UkIL0fAHw2nB0I
 HqbrjeSyTWv5QvEV8uXDEhuNrE8Vy4F4O9cqehk5C+5HIbAbV8LZZlD/DdaARKQzTu1y0bga0
 PXz0Yek7M86qLBqltRFvX8AXxsienT0lyVEH/5lJ2S5PVDhHfTiH1VSM6b3Gu8qTN718pYeBX
 wjmnFdg8f6xxL/pJGSIZrsw2Mn5dFyZQwSANW5obsmlZJRuTKfGJ+vmq+F9ETEilUBnx99sZ8
 R4+XfrxAMVyiw58M/V2z50WEkyYJ4yqUIxuD5MhVW1ztkTkb9dVJaLsG3vQznmRiswY5iMi9Q
 EKZYQv+W+0nbX6XWHNfW89V5gyyqzaGCIit4sQVxIJl0QX1uKVr4KikNhxi12DFMF2JivOkL5
 LznJ0goERbvgTRGrpxnw8EmK+mUxtbGc7gFGv70wTDPXyhViu7qtUxXSF4qCBfwzEuJS5gZOI
 CJc6VBCyiET11Ou6pebSNvwBwgSpvnVd8qWUS7krTiRGdJejPn1T2WGGxo+dDuIPcRWLq+41t
 E8+YMAgb/sXCJXRnG1fP3sKU1txSGq/j9d/FhxW6C/fPmJB8fzxj8QgIINHMdt6sOscEhFkfv
 0RIuJWhUUoQCzRrsDmgbKPZeIQ0EI1HwkvMtPEZadN2EoKMz5IVyeDGjN6g1dSgp6Aljc32bQ
 2nnYldVcuR46JTRAGlLvIo+49vAEI4L7NASTLP/D+hGFrOktEh1hm02hF9N2uDHpkBGK17F79
 tdrjOzdBKGQ+g6sbsk1IZlECx7d3rSHfEQICkw==
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: "Dr. David Alan Gilbert" <dgilbert@redhat.com>

Kill off a pile of monitor_printf's and cur_mon usage.
The only one left in wavcapture.c is the info case.

Signed-off-by: Dr. David Alan Gilbert <dgilbert@redhat.com>
Reviewed-by: Gerd Hoffmann <kraxel@gmail.com>
Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
Message-Id: <20170320173840.3626-3-dgilbert@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 audio/wavcapture.c | 39 +++++++++++++++++----------------------
 1 file changed, 17 insertions(+), 22 deletions(-)

diff --git a/audio/wavcapture.c b/audio/wavcapture.c
index cf31ed652c2b..cd24570aa70c 100644
--- a/audio/wavcapture.c
+++ b/audio/wavcapture.c
@@ -38,30 +38,29 @@ static void wav_destroy (void *opaque)
     uint8_t dlen[4];
     uint32_t datalen = wav->bytes;
     uint32_t rifflen = datalen + 36;
-    Monitor *mon = cur_mon;
 
     if (wav->f) {
         le_store (rlen, rifflen, 4);
         le_store (dlen, datalen, 4);
 
         if (fseek (wav->f, 4, SEEK_SET)) {
-            monitor_printf (mon, "wav_destroy: rlen fseek failed\nReason: %s\n",
-                            strerror (errno));
+            error_report("wav_destroy: rlen fseek failed: %s",
+                         strerror(errno));
             goto doclose;
         }
         if (fwrite (rlen, 4, 1, wav->f) != 1) {
-            monitor_printf (mon, "wav_destroy: rlen fwrite failed\nReason %s\n",
-                            strerror (errno));
+            error_report("wav_destroy: rlen fwrite failed: %s",
+                         strerror(errno));
             goto doclose;
         }
         if (fseek (wav->f, 32, SEEK_CUR)) {
-            monitor_printf (mon, "wav_destroy: dlen fseek failed\nReason %s\n",
-                            strerror (errno));
+            error_report("wav_destroy: dlen fseek failed: %s",
+                         strerror(errno));
             goto doclose;
         }
         if (fwrite (dlen, 1, 4, wav->f) != 4) {
-            monitor_printf (mon, "wav_destroy: dlen fwrite failed\nReason %s\n",
-                            strerror (errno));
+            error_report("wav_destroy: dlen fwrite failed: %s",
+                         strerror(errno));
             goto doclose;
         }
     doclose:
@@ -78,8 +77,7 @@ static void wav_capture (void *opaque, void *buf, int size)
     WAVState *wav = opaque;
 
     if (fwrite (buf, size, 1, wav->f) != 1) {
-        monitor_printf (cur_mon, "wav_capture: fwrite error\nReason: %s",
-                        strerror (errno));
+        error_report("wav_capture: fwrite error: %s", strerror(errno));
     }
     wav->bytes += size;
 }
@@ -110,7 +108,6 @@ static struct capture_ops wav_capture_ops = {
 int wav_start_capture (CaptureState *s, const char *path, int freq,
                        int bits, int nchannels)
 {
-    Monitor *mon = cur_mon;
     WAVState *wav;
     uint8_t hdr[] = {
         0x52, 0x49, 0x46, 0x46, 0x00, 0x00, 0x00, 0x00, 0x57, 0x41, 0x56,
@@ -124,13 +121,13 @@ int wav_start_capture (CaptureState *s, const char *path, int freq,
     CaptureVoiceOut *cap;
 
     if (bits != 8 && bits != 16) {
-        monitor_printf (mon, "incorrect bit count %d, must be 8 or 16\n", bits);
+        error_report("incorrect bit count %d, must be 8 or 16", bits);
         return -1;
     }
 
     if (nchannels != 1 && nchannels != 2) {
-        monitor_printf (mon, "incorrect channel count %d, must be 1 or 2\n",
-                        nchannels);
+        error_report("incorrect channel count %d, must be 1 or 2",
+                     nchannels);
         return -1;
     }
 
@@ -158,8 +155,8 @@ int wav_start_capture (CaptureState *s, const char *path, int freq,
 
     wav->f = fopen (path, "wb");
     if (!wav->f) {
-        monitor_printf (mon, "Failed to open wave file `%s'\nReason: %s\n",
-                        path, strerror (errno));
+        error_report("Failed to open wave file `%s': %s",
+                     path, strerror(errno));
         g_free (wav);
         return -1;
     }
@@ -170,14 +167,13 @@ int wav_start_capture (CaptureState *s, const char *path, int freq,
     wav->freq = freq;
 
     if (fwrite (hdr, sizeof (hdr), 1, wav->f) != 1) {
-        monitor_printf (mon, "Failed to write header\nReason: %s\n",
-                        strerror (errno));
+        error_report("Failed to write header: %s", strerror(errno));
         goto error_free;
     }
 
     cap = AUD_add_capture (&as, &ops, wav);
     if (!cap) {
-        monitor_printf (mon, "Failed to add audio capture\n");
+        error_report("Failed to add audio capture");
         goto error_free;
     }
 
@@ -189,8 +185,7 @@ int wav_start_capture (CaptureState *s, const char *path, int freq,
 error_free:
     g_free (wav->path);
     if (fclose (wav->f)) {
-        monitor_printf (mon, "Failed to close wave file\nReason: %s\n",
-                        strerror (errno));
+        error_report("Failed to close wave file: %s", strerror(errno));
     }
     g_free (wav);
     return -1;

From patchwork Thu Feb 14 10:47:15 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812411
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 88A2613A4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 75B362D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 69FC12D6B0; Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 0D4DE2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:04 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2405458AbfBNKsD (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from mout.kundenserver.de ([212.227.126.135]:38933 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395333AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1N8oKc-1h6zsz3YhS-015q5Y; Thu, 14 Feb 2019 11:47:48 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>, =?utf-8?q?Philippe_Mathie?=
	=?utf-8?q?u-Daud=C3=A9?= <philmd@redhat.com>, Thomas Huth <thuth@redhat.com>,
 Stefano Garzarella <sgarzare@redhat.com>
Subject: [PULL 12/14] hw/dma/i8257: Use qemu_log_mask(UNIMP) instead of
 fprintf
Date: Thu, 14 Feb 2019 11:47:15 +0100
Message-Id: <20190214104717.3543-13-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:J7mRyDYOD38Kb3OrYj08T2sfYhUIjMhl4UqoH6czZ6hT9NXGNtt
 kqXDpIeez85B2GBLctlGjNTnGUOcTE7p0VADhje7S+yvOebE9THy/yajPyR9zjRE+UXC4yk
 7CrrF8kLILUsfRSr/Bn8xDBRbNU3KL7yu4nVPJ4K4KRx0cvSZoXJ0OcqMHX3SJQu1EBKRmG
 eTu7l4QVztPUdmGdjXiNw==
X-UI-Out-Filterresults: notjunk:1;V03:K0:rISYavrEtlY=:tpboYl/9rmZkb376tj8du/
 o5WeGRlCXorHltLufOp7j1P7cYCigSHkirttjVuBhh6OiQRqG1WW2xfK6K929BZXTVx0FA9TT
 PTSRXWVP1CwhR6IFgH1+qros9O7igXeiqK1ThH4RipccdhYJVIYHIdO/GK8VWNw0334fbWAT8
 CcXV/iQoB6qNavh66Osz2f9FHL8rIRbL2+mdwiXskxZqPwflEVWkMCb13nMPlXnqO8JALA4Qc
 +ZIjcleMJcxVGB9OkunACDGkocLlv+fiHGBjYRmB5CP6M8H3Q1AxkYprjIw3EhlTUgiO43OEP
 AB2WCjwox3A+INJ3CDjrTFlXXlzoOuPDiJDeYNpp4HF7jrTktxTxNWsUek3BSzDC13StPJPx+
 PYV14Q53wpCpWCu1hIy/Sv6cLyq9qIbZ7SjTZTwF3frqs6loe0ISesDQBO3/WXasFiPZpjDSQ
 mhmOQrt4TsmYYCUTmVd1avjCVJiZLAlt6MrovXXuLWTRndbD63mdkeq97kUAGpoDIvEiJPMPL
 D7X9iBvheEaS+dq9pJj3ksrrjUhQvO4T+xId4xau9YU26R+NkVMldPzQV6slfegbXDV/HMXDa
 PkkyowGwBLl4Z8IvQgfEGJ4OMtVYPrmKm6dH0ljFXMXzmPo+eCPB7zCf6M6+fBJyEBcfdfI6B
 56Kd0tc1FmKDT9PJWFWOPE3M9hfgHVVilFHeCkFqB9u7p6RLkOHRJl1gSv5egDc5CJRfZQWrF
 UMWhdIAczpMkHsoeKd4/lrTccP1QGk8nThhCtEW07xgXkRkPo2kDZhAOhJo=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Philippe Mathieu-Daudé <philmd@redhat.com>

Avoid to clutter stdout until explicitly requested (with -d unimp):

  $ qemu-system-mips64el -M fulong2e -bios pmon_2e.bin
  dma: command df not supported
  dma: command df not supported
  dma: command df not supported
  dma: command df not supported

Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Reviewed-by: Thomas Huth <thuth@redhat.com>
Reviewed-by: Stefano Garzarella <sgarzare@redhat.com>
Message-Id: <20190212145322.30974-1-philmd@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 hw/dma/i8257.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/hw/dma/i8257.c b/hw/dma/i8257.c
index 52675e97c9e7..3e1f13a4aaf4 100644
--- a/hw/dma/i8257.c
+++ b/hw/dma/i8257.c
@@ -26,6 +26,7 @@
 #include "hw/isa/isa.h"
 #include "hw/dma/i8257.h"
 #include "qemu/main-loop.h"
+#include "qemu/log.h"
 #include "trace.h"
 
 #define I8257(obj) \
@@ -185,7 +186,8 @@ static void i8257_write_cont(void *opaque, hwaddr nport, uint64_t data,
     switch (iport) {
     case 0x00:                  /* command */
         if ((data != 0) && (data & CMD_NOT_SUPPORTED)) {
-            dolog("command %"PRIx64" not supported\n", data);
+            qemu_log_mask(LOG_UNIMP, "%s: cmd 0x%02"PRIx64" not supported\n",
+                          __func__, data);
             return;
         }
         d->command = data;

From patchwork Thu Feb 14 10:47:16 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812431
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 514A813B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:25 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 3EC242D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:25 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 329312D6B0; Thu, 14 Feb 2019 10:48:25 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 886672D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:24 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2395349AbfBNKsV (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:21 -0500
Received: from mout.kundenserver.de ([212.227.126.135]:45461 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2395378AbfBNKsC (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:02 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MuUza-1hCRvj0XPm-00rU5U; Thu, 14 Feb 2019 11:47:49 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>, Paolo Bonzini <pbonzini@redhat.com>,
 kvm@vger.kernel.org, libvir-list@redhat.com,
 "Michael S. Tsirkin" <mst@redhat.com>, Eric Blake <eblake@redhat.com>,
 Markus Armbruster <armbru@redhat.com>, Michael Tokarev <mjt@tls.msk.ru>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-trivial@nongnu.org,
 Gerd Hoffmann <kraxel@redhat.com>, Artyom Tarasenko <atar4qemu@gmail.com>,
 Kamil Rytarowski <kamil@netbsd.org>,
 Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
 Thomas Huth <thuth@redhat.com>,
 =?utf-8?q?Philippe_Mathieu-Daud=C3=A9?= <philmd@redhat.com>
Subject: [PULL 13/14] hw/sparc64: Explicitly set default_display = "std"
Date: Thu, 14 Feb 2019 11:47:16 +0100
Message-Id: <20190214104717.3543-14-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Provags-ID: V03:K1:clkzpb0kf5OkOTkDePAWmbK+LGoWFoOkSqYIO+AEwTedXnBh+68
 Sal3EDlWvFtfve9SmjgAGQvgMVwHw8fAb3FpYqzisB2GFZMPLfyy8RKV4bU5qietBq4rmvh
 tb3QMnL9T96G8nRZ26ZvRDpIjjIfx2feGKXUoB9sR5wz6jokCOiBm0vjF2gccWuPpOlnW7y
 mh/uwoGqWk9OausF/Mn9A==
X-UI-Out-Filterresults: notjunk:1;V03:K0:tizVtLKisjk=:6MMMqO4MJ4LmETSx67nExd
 ITqZGG6+fshWRL8DbJ0QDBrL2Lo/2fT8qwV4+rek1wZthWXol9rxr/I7hwg8y8EkSZtq4HT17
 8G//GkZkrOIwWR2s0aXQrrpeLpsfxSHBRtasVwhjQlVOOz6pXkVXhWJII+YSXiG6pxe1k5azy
 BG0DzLFbEamq+A6fTrTeVGH/phS3sicdN85O/SFqMb7UGmeoQxEZWd6SGzyJ/5Z0VVgcZYTpE
 owsE5VfdmMB2q+9qBNKed4kUQnegU+9uymaykBCreXi/000gSfFQw1hkcc/szwsh4IBIL/03A
 krfJRGoC3enDsrWlNefLZG27eucZn5znWWX/6Lplc+jK6RhLE20Bi1L5XyoQLjTQJQnhg95aj
 0pEAqsfq2L3lYs9otP6LOe3bippeOKko/3nK8WFrRFghBoTHkNTuTSf+f8j1AtIxTCdirTDH2
 1GaKRWh0CXpmUsc/Fmk+eZ2Uh+Jxm9tIaIo7IxAkB+wtnEbYVnuPd+lBEouhuHuLCvgPg+vAf
 bu1y8lL1hwtcT5iFXb9xZiML+nBz0tBimOvAVZRjrvzCDPorg9Ni38q1IwJ58kVAOM4805/UO
 SqnRMOoUIicGPe407cLEnokOeiMGHVHVwOHRRLXr6+w2Wwoj8A2uYFjGVsw4aDGqwehEV2aZy
 d0qxAGWtvzKGbKlAbZhA968b7pp69qr2irgI202Rn1b9JunRw3qojeMGrnrKRDUqJ8hWnVxSy
 hFe9WC1HFH+w8aRM1ACAiQ7dNT2ZEG/k7vTlOrBlj1dx2xsbPTMxs+aIwrY=
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Thomas Huth <thuth@redhat.com>

The sun4uv_init() function expects vga_interface_type to be either
VGA_STD or VGA_NONE and sets up a stdvga device or no vga card
accordingly.
However, the code in vl.c prefers the Cirrus VGA card to stdvga if
it is available and the user and the machine did not specify anything
else.
So far this has not been a problem, since the Cirrus VGA was not linked
into the sparc64 target. But with the upcoming Kconfig build system,
all theoretically possible PCI cards will be enabled by default, so the
Cirrus VGA card might become available on the sparc64 target, too. vl.c
then picks the wrong card, causing sun4uv_init() to abort.
Thus let's make it explicit that we always want stdvga for sparc64 and
so set default_display = "std" for these machines.

Signed-off-by: Thomas Huth <thuth@redhat.com>
Reviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>
Reviewed-by: Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>
Message-Id: <1550041639-10232-1-git-send-email-thuth@redhat.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 hw/sparc64/sun4u.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/hw/sparc64/sun4u.c b/hw/sparc64/sun4u.c
index ff24d9b35016..399f2d73c814 100644
--- a/hw/sparc64/sun4u.c
+++ b/hw/sparc64/sun4u.c
@@ -797,6 +797,7 @@ static void sun4u_class_init(ObjectClass *oc, void *data)
     mc->default_boot_order = "c";
     mc->default_cpu_type = SPARC_CPU_TYPE_NAME("TI-UltraSparc-IIi");
     mc->ignore_boot_device_suffixes = true;
+    mc->default_display = "std";
     fwc->get_dev_path = sun4u_fw_dev_path;
 }
 
@@ -820,6 +821,7 @@ static void sun4v_class_init(ObjectClass *oc, void *data)
     mc->max_cpus = 1; /* XXX for now */
     mc->default_boot_order = "c";
     mc->default_cpu_type = SPARC_CPU_TYPE_NAME("Sun-UltraSparc-T1");
+    mc->default_display = "std";
 }
 
 static const TypeInfo sun4v_type = {

From patchwork Thu Feb 14 10:47:17 2019
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Laurent Vivier <laurent@vivier.eu>
X-Patchwork-Id: 10812419
Return-Path: <kvm-owner@kernel.org>
Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org
 [172.30.200.125])
	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id 9F94F13B4
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:07 +0000 (UTC)
Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 8DFDB2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:07 +0000 (UTC)
Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486)
	id 825B62D6B1; Thu, 14 Feb 2019 10:48:07 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	pdx-wl-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 24BEE2D6AD
	for <patchwork-kvm@patchwork.kernel.org>;
 Thu, 14 Feb 2019 10:48:07 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2406722AbfBNKsF (ORCPT
        <rfc822;patchwork-kvm@patchwork.kernel.org>);
        Thu, 14 Feb 2019 05:48:05 -0500
Received: from mout.kundenserver.de ([212.227.126.130]:53003 "EHLO
        mout.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2405057AbfBNKsD (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 14 Feb 2019 05:48:03 -0500
Received: from localhost.localdomain ([78.238.229.36]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1Mk0a0-1hN0sI1cTI-00kRt0; Thu, 14 Feb 2019 11:47:50 +0100
From: Laurent Vivier <laurent@vivier.eu>
To: qemu-devel@nongnu.org
Cc: Laurent Vivier <laurent@vivier.eu>,
        Paolo Bonzini <pbonzini@redhat.com>, kvm@vger.kernel.org,
        libvir-list@redhat.com, "Michael S. Tsirkin" <mst@redhat.com>,
        Eric Blake <eblake@redhat.com>,
        Markus Armbruster <armbru@redhat.com>,
        Michael Tokarev <mjt@tls.msk.ru>,
        "Dr. David Alan Gilbert" <dgilbert@redhat.com>,
        qemu-trivial@nongnu.org, Gerd Hoffmann <kraxel@redhat.com>,
        Artyom Tarasenko <atar4qemu@gmail.com>,
        Kamil Rytarowski <kamil@netbsd.org>,
        Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>,
        Thomas Petazzoni <thomas.petazzoni@bootlin.com>,
        Thomas Huth <thuth@redhat.com>
Subject: [PULL 14/14] configure: improve usbfs check
Date: Thu, 14 Feb 2019 11:47:17 +0100
Message-Id: <20190214104717.3543-15-laurent@vivier.eu>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190214104717.3543-1-laurent@vivier.eu>
References: <20190214104717.3543-1-laurent@vivier.eu>
MIME-Version: 1.0
X-Provags-ID: V03:K1:oEJO8vGs3P/U5J3a0d60Q6qpUGstg5SafroEl9jicDD4f7bYeme
 VPeirvNOb8XH4PEm4hROIBVH4YfiF2jJQkAPLIk9amm2l9daSMhqCSfiRf+WCzmB1Yg3ixs
 Nzh8PS2boU8SgpuEuw7SO+r+GS04dO+JvRJIwZWJYGOGgnr2143cY576KETkHxviicW3KeJ
 uQNg5hA5RB3kGJzlENE/g==
X-UI-Out-Filterresults: notjunk:1;V03:K0:jZ25PKVJrfk=:bHMGy/muyHN+uH7VJOLnYa
 pv1GWHEZAtyiC84Hp4LfGzh1rh20yCw2+L3p03Fq8DJcSLtSoa8jQfysNq2azSKVLJ/B4V5Dm
 RinX/O+xTx08s7S6wqV8tdecS/qAjufNrWgd9Glwtf1+BF3SHCRqj9It6jKPmU7z4MTbZprbe
 KLE4tDXGIn3fG83vgvnXHa9tMfu8fsUR5jQL4TeYVjFcGvEx1KZEW+Qfm03h1Rgiqa+X0Dj91
 13kkj+Skffq7G1I0O5Ht+B06dPuKm0Oj8T7IBVSShOzOBLmB4iurnlG5LbXJv9TI62wiGcSVn
 C/WII6eBdKcXx84cMt7SAF6AvnrpG4Tl6/z5p5bnYd0H9CFSynGkkgpMPQqY3DZCWjwPfsBzn
 bj3s25lr6pnxdRuIh3X1vYhqmQRW1FtPku7S3nDl0XO84pzPP3y3YqNv7FvjcC+d9x+SGixsX
 Kl9EFzBBMFKnv6jzsWI7nX9tFn3M79PbMWADwmm/ej9c8JN5888WcTMSmN5wcn4fkJTgELqz6
 l631OJ7VfUXWprTO0jEPC9viWx2QJ4Vlg1BExzCkZrcfLwjcmGrBpIPL+9lQb+EoAYHIwzEua
 HTNL3poD+Ou6ImDLrY/ovkPVCTMoCLIX+cltMQmpubZ2CNk0/c1HOflOnvz9Y6Ctwl81zjqSj
 Oa3qQGm8uTXAzsxnssnSNjG0CNr5ETfFjzWCGZJITL3VA7lJMQBOU6q1nhWujlMl/eu1Xi4ug
 HQwWdWVYHHFgb0jDoiHPP/DR1EEdfZU+f6UrIQ==
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org
X-Virus-Scanned: ClamAV using ClamSMTP

From: Thomas Petazzoni <thomas.petazzoni@bootlin.com>

The current check to test if usbfs support should be compiled or not
solely relies on the presence of <linux/usbdevice_fs.h>, without
actually checking that all definition used by Qemu are provided by
this header file.

With sufficiently old kernel headers, <linux/usbdevice_fs.h> may be
present, but some of the definitions needed by Qemu may not be
available.

This commit improves the check by building a small program that
actually tests whether the necessary definitions are available.

In addition, it fixes a bug where have_usbfs was set to "yes"
regardless of the result of the test.

Signed-off-by: Thomas Petazzoni <thomas.petazzoni@bootlin.com>
Reviewed-by: Thomas Huth <thuth@redhat.com>
Message-Id: <20190213211827.20300-1-thomas.petazzoni@bootlin.com>
Signed-off-by: Laurent Vivier <laurent@vivier.eu>
---
 configure | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index c0f278141823..90b9e2fa3c05 100755
--- a/configure
+++ b/configure
@@ -4262,10 +4262,25 @@ fi
 # check for usbfs
 have_usbfs=no
 if test "$linux_user" = "yes"; then
-  if check_include linux/usbdevice_fs.h; then
+  cat > $TMPC << EOF
+#include <linux/usbdevice_fs.h>
+
+#ifndef USBDEVFS_GET_CAPABILITIES
+#error "USBDEVFS_GET_CAPABILITIES undefined"
+#endif
+
+#ifndef USBDEVFS_DISCONNECT_CLAIM
+#error "USBDEVFS_DISCONNECT_CLAIM undefined"
+#endif
+
+int main(void)
+{
+    return 0;
+}
+EOF
+  if compile_prog "" ""; then
     have_usbfs=yes
   fi
-  have_usbfs=yes
 fi
 
 # check for fallocate
